---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import StepPanel from '../components/configurator/StepPanel.astro';
import ToggleButton from '../components/configurator/ToggleButton.astro';
import FeatureCard from '../components/configurator/FeatureCard.astro';

const websiteTypes = [
  { id: 'company', label: 'Firemn√≠ web', description: 'Profesion√°ln√≠ prezentace firmy a sbƒõr popt√°vek.' },
  { id: 'landing', label: 'Landing page', description: 'Jednostr√°nkov√° kampa≈à zamƒõ≈ôen√° na konverze.' },
  { id: 'portfolio', label: 'Portfolio', description: 'Uk√°zka projekt≈Ø, referenc√≠ a d≈Øvƒõryhodnosti.' },
  { id: 'blog', label: 'Blog', description: 'Obsahov√Ω web pro publikov√°n√≠ a lep≈°√≠ viditelnost na Googlu.' },
  { id: 'ecommerce', label: 'E-shop', description: 'Katalog produkt≈Ø, objedn√°vky a prodejn√≠ proces.' },
  { id: 'webapp', label: 'Webov√° aplikace', description: 'Interaktivn√≠ aplikace s u≈æivatelskou logikou a pokroƒçil√Ωmi funkcemi.' }
];

const pagesCatalog = [
  { id: 'home', label: 'Dom≈Ø', description: 'Hlavn√≠ vstupn√≠ str√°nka' },
  { id: 'about', label: 'O n√°s', description: 'D≈Øvƒõra a p≈ô√≠bƒõh t√Ωmu' },
  { id: 'services', label: 'Slu≈æby', description: 'Nab√≠dka a hodnota pro klienta' },
  { id: 'portfolio', label: 'Portfolio', description: 'P≈ô√≠padov√© studie a d≈Økazy v√Ωsledk≈Ø' },
  { id: 'pricing', label: 'Cen√≠k', description: 'Transparentn√≠ struktura nab√≠dky' },
  { id: 'blog', label: 'Blog', description: 'ƒål√°nky a obsahov√Ω hub' },
  { id: 'faq', label: 'FAQ', description: 'Odpovƒõdi na kl√≠ƒçov√© ot√°zky' },
  { id: 'contact', label: 'Kontakt', description: 'P≈ôed√°n√≠ popt√°vky a komunikace' },
  { id: 'shop', label: 'Obchod', description: 'V√Ωpis produkt≈Ø' },
  { id: 'checkout', label: 'Ko≈°√≠k a objedn√°vka', description: 'Dokonƒçen√≠ objedn√°vky' },
  { id: 'dashboard', label: 'U≈æivatelsk√° z√≥na', description: 'P≈ôehled u≈æivatelsk√©ho √∫ƒçtu' }
];

const featuresCatalog = [
  { id: 'contact-form', title: 'Kontaktn√≠ formul√°≈ôe', icon: 'mail', description: 'Sb√≠rejte popt√°vky pomoc√≠ p≈ôehledn√Ωch formul√°≈ô≈Ø.' },
  { id: 'analytics', title: 'Analytika', icon: 'analytics', description: 'Sledujte n√°v≈°tƒõvnost a chov√°n√≠ u≈æivatel≈Ø v p≈ôehledn√Ωch reportech.' },
  { id: 'seo', title: 'Nastaven√≠ viditelnosti ve vyhled√°v√°n√≠', icon: 'travel_explore', description: 'Nastav√≠me strukturu webu tak, aby v√°s lid√© na≈°li na Googlu a dal≈°√≠ch vyhled√°vaƒç√≠ch.' },
  { id: 'newsletter', title: 'Newsletter', icon: 'campaign', description: 'Budujte publikum a n√°vratnost pomoc√≠ e-mailov√Ωch kampan√≠.' },
  { id: 'auth', title: 'P≈ôihl√°≈°en√≠ u≈æivatel≈Ø', icon: 'verified_user', description: 'Bezpeƒçn√© p≈ôihl√°≈°en√≠ a p≈ô√≠stup k u≈æivatelsk√©mu √∫ƒçtu.' },
  { id: 'admin-panel', title: 'Administrace', icon: 'admin_panel_settings', description: 'Intern√≠ spr√°va u≈æivatel≈Ø, obsahu a nastaven√≠.' },
  { id: 'payments', title: 'Platby', icon: 'credit_card', description: 'Online platebn√≠ proces a zpracov√°n√≠ transakc√≠.' },
  { id: 'order-system', title: 'Objedn√°vkov√Ω syst√©m', icon: 'receipt_long', description: 'Zpracov√°n√≠ objedn√°vek, stavy a n√°vazn√° logika.' },
  { id: 'dynamic-cms-db', title: 'Dynamick√© CMS + DB', icon: 'edit_note', description: 'Spr√°va obsahu napojen√° na datab√°zi.' }
];

const fontPairs = [
  {
    id: 'inter-space',
    label: 'Inter + Space Grotesk',
    heading: "'Space Grotesk', Inter, sans-serif",
    body: 'Inter, sans-serif',
    preview: 'Modern√≠ a ƒçist√Ω styl s jasnou hierarchi√≠.'
  },
  {
    id: 'manrope-inter',
    label: 'Manrope + Inter',
    heading: 'Manrope, Inter, sans-serif',
    body: 'Inter, sans-serif',
    preview: 'Neutr√°ln√≠, ƒçiteln√Ω a konverznƒõ orientovan√Ω styl.'
  },
  {
    id: 'playfair-inter',
    label: 'Playfair + Inter',
    heading: "'Playfair Display', Georgia, serif",
    body: 'Inter, sans-serif',
    preview: 'Pr√©miov√Ω redakƒçn√≠ vzhled znaƒçky.'
  },
  {
    id: 'poppins-roboto',
    label: 'Poppins + Roboto',
    heading: 'Poppins, Inter, sans-serif',
    body: 'Roboto, Inter, sans-serif',
    preview: 'P≈ô√°telsk√Ω a velmi ƒçiteln√Ω vizu√°ln√≠ styl.'
  },
  {
    id: 'montserrat-source',
    label: 'Montserrat + Source Sans',
    heading: 'Montserrat, Inter, sans-serif',
    body: "'Source Sans 3', Inter, sans-serif",
    preview: 'Strukturovan√Ω firemn√≠ vzhled s d≈Ørazem na p≈ôehlednost.'
  }
];

const presets = {
  company: {
    hosting: 'static',
    pages: {
      required: ['home', 'contact'],
      recommended: ['about', 'services', 'faq', 'pricing', 'portfolio'],
      default: []
    },
    features: {
      required: [],
      recommended: ['contact-form', 'analytics', 'seo'],
      default: []
    }
  },
  landing: {
    hosting: 'static',
    pages: {
      required: ['home'],
      recommended: ['contact'],
      default: []
    },
    features: {
      required: [],
      recommended: ['contact-form', 'analytics', 'seo'],
      default: []
    }
  },
  portfolio: {
    hosting: 'static',
    pages: {
      required: ['home', 'portfolio', 'contact'],
      recommended: ['about'],
      default: []
    },
    features: {
      required: [],
      recommended: ['contact-form', 'analytics', 'seo'],
      default: []
    }
  },
  blog: {
    hosting: 'static',
    pages: {
      required: ['home', 'blog'],
      recommended: ['about', 'contact'],
      default: []
    },
    features: {
      required: ['dynamic-cms-db'],
      recommended: ['newsletter', 'analytics', 'seo'],
      default: []
    }
  },
  ecommerce: {
    hosting: 'fullstack',
    pages: {
      required: ['shop', 'checkout'],
      recommended: ['home', 'faq', 'dashboard'],
      default: []
    },
    features: {
      required: ['order-system', 'payments', 'admin-panel', 'dynamic-cms-db'],
      recommended: ['auth', 'contact-form', 'analytics', 'seo', 'newsletter'],
      default: []
    }
  },
  webapp: {
    hosting: 'fullstack',
    pages: {
      required: ['dashboard', 'home'],
      recommended: ['contact', 'faq'],
      default: []
    },
    features: {
      required: ['admin-panel', 'auth', 'dynamic-cms-db'],
      recommended: ['contact-form', 'analytics', 'seo', 'newsletter'],
      default: []
    }
  }
};

const hostingTriggerFeatures = ['auth', 'admin-panel', 'payments', 'order-system', 'dynamic-cms-db'];

const initialType = 'company';
const initialPreset = presets[initialType];
const initialPages = [...initialPreset.pages.required, ...initialPreset.pages.recommended, ...initialPreset.pages.default];
const nonPreselectedRecommendedFeatureKeys = new Set(['analytics']);
const initialRecommendedFeatures = [...initialPreset.features.recommended].filter((featureId) => !nonPreselectedRecommendedFeatureKeys.has(featureId));
const initialFeatures = [...initialPreset.features.required, ...initialRecommendedFeatures, ...initialPreset.features.default];
---

<Layout title="Webov√Ω konfigur√°tor | NexusDigital">
  <Header />

  <main class="relative overflow-hidden pt-28 pb-20 min-h-screen bg-background-light dark:bg-background-dark px-4 md:px-6">
    <div class="absolute -top-20 -left-20 w-72 h-72 rounded-full bg-primary/10 blur-3xl pointer-events-none"></div>
    <div class="absolute top-40 -right-20 w-80 h-80 rounded-full bg-primary/10 blur-3xl pointer-events-none"></div>

    <section class="max-w-6xl mx-auto relative z-10">
      <div class="max-w-3xl mb-8">
        <p class="text-primary text-xs font-black tracking-[0.14em] uppercase mb-3">Webov√Ω konfigur√°tor</p>
        <h1 class="text-4xl md:text-5xl font-black tracking-tight text-slate-900 dark:text-white leading-tight mb-4">Napl√°nujte projekt pomoc√≠ chytr√©ho 6krokov√©ho konfigur√°toru</h1>
        <p class="text-slate-600 dark:text-slate-400 text-lg">Chytr√© presety, interaktivn√≠ ovl√°d√°n√≠, ≈æiv√Ω n√°hled designu a fin√°ln√≠ souhrn v jednom toku.</p>
      </div>

      <form id="configuratorForm" action="/thank-you" method="get" class="space-y-4">
        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-5 md:p-6">
          <div class="flex items-center justify-between gap-4 flex-wrap mb-3">
            <p id="stepCounter" class="text-sm font-bold uppercase tracking-wider text-primary">Krok 1 / 6</p>
            <p id="stepTitle" class="text-sm font-semibold text-slate-500 dark:text-slate-400">Typ webu</p>
          </div>
          <div class="h-2 rounded-full bg-slate-100 dark:bg-slate-800 overflow-hidden">
            <div id="stepProgress" class="h-full bg-primary transition-all duration-300" style="width: 16.66%"></div>
          </div>
        </div>

        <StepPanel step={1} title="Typ webu" subtitle="Vyberte typ projektu a nechte presety automaticky nastavit str√°nky, funkce i hosting." active={true}>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            {websiteTypes.map((item, index) => (
              <button
                type="button"
                data-website-type
                data-id={item.id}
                class:list={{ 'cfg-type-btn': true, 'is-active': index === 0 }}
                aria-pressed={index === 0 ? 'true' : 'false'}
              >
                <p class="font-extrabold text-slate-900 dark:text-white text-base mb-1">{item.label}</p>
                <p class="text-sm text-slate-500 dark:text-slate-400">{item.description}</p>
              </button>
            ))}
          </div>

          <div class="mt-5 inline-flex items-center gap-2 bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2">
            <span class="material-symbols-outlined text-primary text-base">deployed_code</span>
            <p id="hostingIndicator" class="text-sm font-semibold text-slate-700 dark:text-slate-300">Hosting: Statick√Ω</p>
          </div>
        </StepPanel>

        <StepPanel step={2} title="Obsah webu" subtitle="P≈ôep√≠naƒçe obsahu webu s doporuƒçen√Ωmi presety.">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            {pagesCatalog.map((page) => (
              <ToggleButton kind="page" id={page.id} label={page.label} description={page.description} />
            ))}
          </div>
          <p class="text-xs text-slate-500 dark:text-slate-400 mt-4">Legenda: Doporuƒçen√© ‚≠ê</p>
        </StepPanel>

        <StepPanel step={3} title="Funkce" subtitle="Karty funkc√≠ se stavov√Ωmi ≈°t√≠tky a kontextov√Ωm vysvƒõtlen√≠m.">
          <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3">
            {featuresCatalog.map((feature) => (
              <FeatureCard id={feature.id} title={feature.title} icon={feature.icon} description={feature.description} />
            ))}
          </div>
        </StepPanel>

        <StepPanel step={4} title="Design studio" subtitle="≈†ablona + p√°rov√°n√≠ font≈Ø + barevn√© t√©ma se ≈æiv√Ωm n√°hledem.">
          <div class="grid grid-cols-1 xl:grid-cols-[1.1fr_0.9fr] gap-5 items-start">
            <div class="space-y-5">
              <div>
                <p class="text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-3">Preset ≈°ablony</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                  {[
                    { id: 'modern', label: 'Modern√≠' },
                    { id: 'minimal', label: 'Minimalistick√Ω' },
                    { id: 'bold', label: 'V√Ωrazn√Ω' },
                    { id: 'elegant', label: 'Elegantn√≠' },
                    { id: 'custom', label: 'Vlastn√≠' }
                  ].map((preset, index) => (
                    <button type="button" data-template={preset.id} class:list={{ 'cfg-toggle-btn': true, 'is-selected': index === 0 }}>
                      <div class="flex items-center justify-between gap-3">
                        <span class="font-extrabold text-slate-900 dark:text-white">{preset.label}</span>
                        <span class="cfg-state-badge">Styl</span>
                      </div>
                    </button>
                  ))}
                </div>
              </div>

              <div>
                <p class="text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-3">P√°rov√°n√≠ font≈Ø</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                  {fontPairs.map((pair, index) => (
                    <button type="button" data-font-pair={pair.id} data-heading-font={pair.heading} data-body-font={pair.body} class:list={{ 'cfg-toggle-btn': true, 'is-selected': index === 0 }}>
                      <p class="font-extrabold text-slate-900 dark:text-white mb-1">{pair.label}</p>
                      <p class="text-xs text-slate-500 dark:text-slate-400">{pair.preview}</p>
                    </button>
                  ))}
                </div>
              </div>

              <div>
                <p class="text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-3">Barevn√© studio</p>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                  <label class="cfg-color-input">Prim√°rn√≠<input data-color="primary" type="color" value="#135bec" /></label>
                  <label class="cfg-color-input">Sekund√°rn√≠<input data-color="secondary" type="color" value="#0f172a" /></label>
                  <label class="cfg-color-input">Akcent<input data-color="accent" type="color" value="#22c55e" /></label>
                  <label class="cfg-color-input">Pozad√≠<input data-color="background" type="color" value="#ffffff" /></label>
                  <label class="cfg-color-input">Text<input data-color="text" type="color" value="#0f172a" /></label>
                </div>
              </div>

              <div>
                <p class="text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-3">Re≈æim</p>
                <div class="grid grid-cols-2 gap-3">
                  <button type="button" data-mode="light" class="cfg-toggle-btn is-selected">Svƒõtl√Ω re≈æim</button>
                  <button type="button" data-mode="dark" class="cfg-toggle-btn">Tmav√Ω re≈æim</button>
                </div>
              </div>
            </div>

            <aside class="xl:sticky xl:top-28">
              <div id="livePreview" class="cfg-live-preview" data-template="modern" data-mode="light">
                <div class="cfg-preview-navbar">
                  <span class="cfg-preview-logo">Nexus</span>
                  <div class="cfg-preview-nav-items">
                    <span>Slu≈æby</span><span>Portfolio</span><span>Kontakt</span>
                  </div>
                </div>

                <div class="cfg-preview-hero">
                  <div>
                    <p class="cfg-preview-kicker">Web zamƒõ≈ôen√Ω na konverze</p>
                    <h3 class="cfg-preview-title">Profesion√°ln√≠ web, kter√Ω podporuje r≈Øst va≈°eho podnik√°n√≠</h3>
                    <p class="cfg-preview-text">≈Ωiv√Ω n√°hled okam≈æitƒõ reaguje na volbu ≈°ablony, fontu i barev.</p>
                    <button type="button" class="cfg-preview-cta">Spustit konfigur√°tor</button>
                  </div>
                  <div class="cfg-preview-media"></div>
                </div>

                <div class="cfg-preview-feature-row">
                  <div class="cfg-preview-feature">Rychl√Ω</div>
                  <div class="cfg-preview-feature">Viditelnost na Googlu</div>
                  <div class="cfg-preview-feature">≈†k√°lovateln√Ω</div>
                </div>

                <div class="cfg-preview-grid">
                  <div class="cfg-preview-card"></div>
                  <div class="cfg-preview-card"></div>
                  <div class="cfg-preview-card"></div>
                </div>

                <div class="cfg-preview-footer">¬© Va≈°e znaƒçka</div>
              </div>
            </aside>
          </div>
        </StepPanel>

        <StepPanel step={5} title="Detaily projektu" subtitle="Rozpoƒçet, ƒçasov√Ω pl√°n a p≈ôipravenost pro realistick√© pl√°nov√°n√≠.">
          <div class="space-y-5">
            <div>
              <p class="text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-3">Rozpoƒçet</p>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <button type="button" data-detail="budget" data-value="5k-10k" class="cfg-toggle-btn is-selected">‚Ç¨5k ‚Äì ‚Ç¨10k</button>
                <button type="button" data-detail="budget" data-value="10k-20k" class="cfg-toggle-btn">‚Ç¨10k ‚Äì ‚Ç¨20k</button>
                <button type="button" data-detail="budget" data-value="20k+" class="cfg-toggle-btn">‚Ç¨20k+</button>
              </div>
            </div>

            <div>
              <p class="text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-3">ƒåasov√Ω r√°mec</p>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <button type="button" data-detail="timeline" data-value="2‚Äì4 t√Ωdny" class="cfg-toggle-btn">2‚Äì4 t√Ωdny</button>
                <button type="button" data-detail="timeline" data-value="4‚Äì8 t√Ωdn≈Ø" class="cfg-toggle-btn is-selected">4‚Äì8 t√Ωdn≈Ø</button>
                <button type="button" data-detail="timeline" data-value="8+ t√Ωdn≈Ø" class="cfg-toggle-btn">8+ t√Ωdn≈Ø</button>
              </div>
            </div>

            <div>
              <p class="text-sm font-bold uppercase tracking-wider text-slate-500 dark:text-slate-400 mb-3">P≈ôipravenost obsahu</p>
              <div class="grid grid-cols-2 gap-3">
                <button type="button" data-detail="contentReady" data-value="Ano" class="cfg-toggle-btn is-selected">Ano, obsah je p≈ôipraven√Ω</button>
                <button type="button" data-detail="contentReady" data-value="Ne" class="cfg-toggle-btn">Ne, pot≈ôebuji pomoc s obsahem</button>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <input id="referenceWebsite" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-4 py-3 outline-none focus:border-primary" type="url" placeholder="URL referenƒçn√≠ho webu" />
              <input id="targetMarket" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-4 py-3 outline-none focus:border-primary" type="text" placeholder="C√≠lov√Ω trh / region" />
            </div>

            <textarea id="additionalNotes" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-4 py-3 outline-none focus:border-primary resize-y" rows="4" placeholder="Dopl≈àuj√≠c√≠ pozn√°mky"></textarea>
          </div>
        </StepPanel>

        <StepPanel step={6} title="Fin√°ln√≠ souhrn" subtitle="V≈°e na jednom m√≠stƒõ: technick√Ω p≈ôehled, odhad a fin√°ln√≠ kontaktn√≠ formul√°≈ô.">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-4">
              <h3 class="font-black mb-3 text-slate-900 dark:text-white">Souhrn konfigurace</h3>
              <div id="summaryStructured" class="space-y-4 text-sm text-slate-600 dark:text-slate-300"></div>
            </div>

            <div class="bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl p-4 space-y-3">
              <div>
                <p class="text-sm text-slate-500 dark:text-slate-400 inline-flex items-center gap-2">
                  Odhadovan√° cena
                  <span id="priceHintWrap" data-summary-hint-wrap class="cfg-summary-hint-wrap hidden">
                    <button type="button" id="priceHintTrigger" data-summary-hint-trigger class="cfg-summary-hint-trigger" aria-label="N√°povƒõda k odhadu ceny">‚ìò</button>
                    <span id="priceHintTooltip" class="cfg-summary-hint-tooltip"></span>
                  </span>
                </p>
                <p id="summaryPrice" class="text-3xl font-black text-primary">‚Ç¨0 ‚Äì ‚Ç¨0</p>
              </div>
              <div>
                <p class="text-sm text-slate-500 dark:text-slate-400 inline-flex items-center gap-2">
                  Odhadovan√Ω term√≠n
                  <span id="timelineHintWrap" data-summary-hint-wrap class="cfg-summary-hint-wrap hidden">
                    <button type="button" id="timelineHintTrigger" data-summary-hint-trigger class="cfg-summary-hint-trigger" aria-label="N√°povƒõda k odhadu term√≠nu">‚ìò</button>
                    <span id="timelineHintTooltip" class="cfg-summary-hint-tooltip"></span>
                  </span>
                </p>
                <p id="summaryTimeline" class="text-xl font-extrabold text-slate-900 dark:text-white">4‚Äì8 t√Ωdn≈Ø</p>
              </div>
              <div>
                <p class="text-sm text-slate-500 dark:text-slate-400">Pozn√°mka k hostingu</p>
                <p id="hostingExplanation" class="text-sm font-semibold text-slate-700 dark:text-slate-300"></p>
              </div>
            </div>
          </div>

          <div class="border-t border-slate-200 dark:border-slate-700 pt-6">
            <h3 class="text-xl font-black mb-4 text-slate-900 dark:text-white">Kontaktn√≠ formul√°≈ô</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <input required name="name" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-4 py-3 outline-none focus:border-primary" type="text" placeholder="Jm√©no" />
              <input required name="email" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-4 py-3 outline-none focus:border-primary" type="email" placeholder="E-mail" />
              <input name="company" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-4 py-3 outline-none focus:border-primary" type="text" placeholder="Spoleƒçnost" />
              <input name="message" class="w-full rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 px-4 py-3 outline-none focus:border-primary" type="text" placeholder="Zpr√°va" />
            </div>
          </div>

          <input type="hidden" id="configJson" name="config" value="" />
          <input type="hidden" id="hostingType" name="hostingType" value="static" />
          <input type="hidden" id="estimatedPriceRange" name="estimatedPriceRange" value="" />
          <input type="hidden" id="estimatedTimelineValue" name="estimatedTimeline" value="" />
        </StepPanel>

        <div class="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 rounded-2xl p-4 flex items-center justify-between gap-3">
          <button type="button" id="prevBtn" class="bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 font-bold px-5 py-2.5 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors" disabled>
            Zpƒõt
          </button>
          <button type="button" id="nextBtn" class="bg-primary text-white font-bold px-5 py-2.5 rounded-xl hover:bg-primary/90 transition-all">
            Dal≈°√≠ krok
          </button>
          <button type="submit" id="submitBtn" class="hidden bg-primary text-white font-bold px-5 py-2.5 rounded-xl hover:bg-primary/90 transition-all">
            Odeslat konfiguraci
          </button>
        </div>
      </form>
    </section>
  </main>

  <Footer hideTopCta={true} />
</Layout>

<style>
  @reference '../styles/global.css';

  .cfg-type-btn,
  :global(.cfg-toggle-btn),
  :global(.cfg-feature-card) {
    @apply w-full text-left rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 p-4 transition-all duration-200;
  }

  .cfg-type-btn:hover,
  :global(.cfg-toggle-btn:hover),
  :global(.cfg-feature-card:hover) {
    @apply border-primary/50;
  }

  .cfg-type-btn.is-active,
  :global(.cfg-toggle-btn.is-selected),
  :global(.cfg-feature-card.is-selected) {
    @apply border-primary bg-primary/15;
  }

  .cfg-type-btn.is-active {
    @apply ring-2 ring-primary/60 shadow-lg shadow-primary/20;
  }

  :global(.cfg-toggle-btn.is-locked),
  :global(.cfg-feature-card.is-locked) {
    @apply cursor-not-allowed opacity-90;
  }

  :global(.cfg-state-badge) {
    @apply inline-flex items-center rounded-full border border-slate-300 dark:border-slate-600 text-[11px] font-bold px-2 py-0.5 text-slate-600 dark:text-slate-300;
  }

  :global(.cfg-feature-card) {
    position: relative;
    min-height: 172px;
    overflow: visible;
    z-index: 1;
    isolation: isolate;
  }

  :global(.cfg-feature-card:hover),
  :global(.cfg-feature-card.tooltip-open) {
    z-index: 40;
  }

  :global(.cfg-tooltip) {
    position: absolute;
    left: 0;
    top: calc(100% + 0.4rem);
    min-width: 15rem;
    max-width: 18rem;
    @apply hidden z-20 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-3 text-xs leading-relaxed text-slate-600 dark:text-slate-300 shadow-lg;
  }

  :global(.cfg-feature-card:hover [data-tooltip]) {
    @apply block;
  }

  :global(.cfg-feature-card.tooltip-open [data-tooltip]) {
    @apply block;
  }

  .cfg-color-input {
    @apply text-xs font-bold text-slate-500 dark:text-slate-400;
  }

  .cfg-color-input input {
    @apply w-full mt-2 h-10 rounded-lg border border-slate-200 dark:border-slate-700;
  }

  :global(.cfg-summary-hint-wrap) {
    @apply relative inline-flex items-center;
  }

  :global(.cfg-summary-hint-trigger) {
    @apply inline-flex items-center justify-center size-5 rounded-full border border-slate-300 dark:border-slate-600 text-[11px] font-bold text-slate-500 dark:text-slate-300 bg-white dark:bg-slate-900;
  }

  :global(.cfg-summary-hint-tooltip) {
    @apply hidden absolute right-0 top-[calc(100%+0.35rem)] z-30 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 p-3 text-xs leading-relaxed text-slate-600 dark:text-slate-300 shadow-lg;
    min-width: 16rem;
    max-width: 18rem;
  }

  :global(.cfg-summary-hint-wrap:hover .cfg-summary-hint-tooltip),
  :global(.cfg-summary-hint-wrap.is-open .cfg-summary-hint-tooltip) {
    @apply block;
  }

  .cfg-live-preview {
    --primary: #135bec;
    --secondary: #0f172a;
    --accent: #22c55e;
    --background: #ffffff;
    --text: #0f172a;
    --font-heading: 'Space Grotesk', Inter, sans-serif;
    --font-body: Inter, sans-serif;

    @apply rounded-2xl border border-slate-200 dark:border-slate-700 p-4 bg-white;
    background: var(--background);
    color: var(--text);
    transition: all 0.25s ease;
  }

  .cfg-live-preview[data-mode='dark'] {
    --background: #0b1220;
    --text: #e2e8f0;
    border-color: rgba(51, 65, 85, 0.8);
  }

  .cfg-preview-navbar,
  .cfg-preview-hero,
  .cfg-preview-feature-row,
  .cfg-preview-grid,
  .cfg-preview-footer {
    @apply rounded-xl border border-slate-200/80 p-3 mb-3;
    border-color: color-mix(in srgb, var(--accent) 30%, #cbd5e1 70%);
  }

  .cfg-preview-navbar {
    @apply flex items-center justify-between;
  }

  .cfg-preview-logo {
    font-family: var(--font-heading);
    font-weight: 800;
    color: var(--secondary);
  }

  .cfg-preview-nav-items {
    @apply flex items-center gap-2 text-[11px] font-bold;
    font-family: var(--font-body);
  }

  .cfg-preview-nav-items span {
    @apply px-2 py-0.5 rounded-full;
    background: color-mix(in srgb, var(--accent) 35%, white 65%);
    color: color-mix(in srgb, var(--secondary) 85%, white 15%);
  }

  .cfg-preview-hero {
    @apply grid grid-cols-[1.15fr_0.85fr] gap-3;
  }

  .cfg-preview-kicker {
    @apply text-[10px] font-black uppercase tracking-[0.08em] mb-1;
    color: var(--primary);
    font-family: var(--font-body);
  }

  .cfg-preview-title {
    @apply text-sm font-black leading-tight mb-1.5;
    font-family: var(--font-heading);
    color: var(--text);
  }

  .cfg-preview-text {
    @apply text-xs mb-2;
    font-family: var(--font-body);
    color: color-mix(in srgb, var(--text) 78%, #64748b 22%);
  }

  .cfg-preview-cta {
    @apply text-[11px] font-bold rounded-full px-3 py-1;
    background: var(--primary);
    color: #fff;
    font-family: var(--font-body);
  }

  .cfg-preview-media {
    @apply rounded-lg;
    background: linear-gradient(135deg, var(--secondary), var(--primary));
  }

  .cfg-preview-feature-row {
    @apply grid grid-cols-3 gap-2;
  }

  .cfg-preview-feature {
    @apply rounded-lg border px-2 py-1 text-center text-[11px] font-bold;
    border-color: color-mix(in srgb, var(--accent) 45%, #cbd5e1 55%);
    background: color-mix(in srgb, var(--accent) 18%, white 82%);
    font-family: var(--font-body);
  }

  .cfg-preview-grid {
    @apply grid grid-cols-3 gap-2;
  }

  .cfg-preview-card {
    @apply rounded-lg h-10;
    background: color-mix(in srgb, var(--accent) 22%, #f8fafc 78%);
    border: 1px solid color-mix(in srgb, var(--secondary) 18%, #cbd5e1 82%);
  }

  .cfg-preview-footer {
    @apply text-center text-[11px] font-bold;
    font-family: var(--font-body);
    color: color-mix(in srgb, var(--text) 75%, #64748b 25%);
  }

  .cfg-live-preview[data-template='minimal'] .cfg-preview-hero {
    @apply grid-cols-1;
  }

  .cfg-live-preview[data-template='minimal'] .cfg-preview-navbar {
    @apply justify-center;
  }

  .cfg-live-preview[data-template='minimal'] .cfg-preview-nav-items {
    @apply hidden;
  }

  .cfg-live-preview[data-template='minimal'] .cfg-preview-feature-row {
    @apply hidden;
  }

  .cfg-live-preview[data-template='minimal'] .cfg-preview-grid {
    @apply grid-cols-1;
  }

  .cfg-live-preview[data-template='minimal'] .cfg-preview-card {
    @apply h-8;
  }

  .cfg-live-preview[data-template='minimal'] .cfg-preview-media {
    @apply hidden;
  }

  .cfg-live-preview[data-template='bold'] .cfg-preview-hero {
    @apply grid-cols-[0.95fr_1.05fr];
    border-width: 2px;
    border-color: var(--primary);
  }

  .cfg-live-preview[data-template='bold'] .cfg-preview-hero > div:first-child {
    order: 2;
  }

  .cfg-live-preview[data-template='bold'] .cfg-preview-media {
    order: 1;
    min-height: 92px;
    border: 2px solid color-mix(in srgb, var(--accent) 55%, transparent 45%);
  }

  .cfg-live-preview[data-template='bold'] .cfg-preview-title {
    @apply uppercase;
    font-size: 0.95rem;
  }

  .cfg-live-preview[data-template='bold'] .cfg-preview-cta {
    border-radius: 0.35rem;
    padding-inline: 0.75rem;
    padding-block: 0.3rem;
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 45%, transparent 55%);
  }

  .cfg-live-preview[data-template='bold'] .cfg-preview-feature-row {
    @apply grid-cols-2;
  }

  .cfg-live-preview[data-template='bold'] .cfg-preview-feature {
    @apply py-2;
    font-size: 12px;
  }

  .cfg-live-preview[data-template='bold'] .cfg-preview-grid {
    @apply grid-cols-2;
  }

  .cfg-live-preview[data-template='bold'] .cfg-preview-card {
    @apply h-14;
  }

  .cfg-live-preview[data-template='elegant'] .cfg-preview-hero {
    @apply grid-cols-1;
  }

  .cfg-live-preview[data-template='elegant'] .cfg-preview-navbar {
    @apply py-4;
    border-color: color-mix(in srgb, var(--accent) 50%, #cbd5e1 50%);
  }

  .cfg-live-preview[data-template='elegant'] .cfg-preview-nav-items span {
    background: transparent;
    border: 1px solid color-mix(in srgb, var(--accent) 50%, #cbd5e1 50%);
  }

  .cfg-live-preview[data-template='elegant'] .cfg-preview-title {
    letter-spacing: 0.02em;
    font-size: 0.9rem;
  }

  .cfg-live-preview[data-template='elegant'] .cfg-preview-hero > div:first-child {
    border: 1px solid color-mix(in srgb, var(--accent) 45%, #cbd5e1 55%);
    border-radius: 0.6rem;
    padding: 0.6rem;
    background: color-mix(in srgb, var(--accent) 10%, #ffffff 90%);
  }

  .cfg-live-preview[data-template='elegant'] .cfg-preview-media {
    min-height: 74px;
  }

  .cfg-live-preview[data-template='custom'] .cfg-preview-hero {
    border-style: dashed;
    border-color: var(--accent);
  }

  .cfg-live-preview[data-template='custom'] .cfg-preview-navbar,
  .cfg-live-preview[data-template='custom'] .cfg-preview-feature-row,
  .cfg-live-preview[data-template='custom'] .cfg-preview-grid,
  .cfg-live-preview[data-template='custom'] .cfg-preview-footer {
    border-style: dashed;
  }
</style>

<script id="cfgData" type="application/json" set:html={JSON.stringify({ presets, pagesCatalog, featuresCatalog, websiteTypes, hostingTriggerFeatures, initialType, initialPages, initialFeatures, initialPreset })}></script>

<script>
  // @ts-nocheck
  const cfgDataElement = document.getElementById('cfgData');
  const cfgData = cfgDataElement?.textContent ? JSON.parse(cfgDataElement.textContent) : {};

  const presets = cfgData.presets ?? {};
  const pagesCatalog = cfgData.pagesCatalog ?? [];
  const featuresCatalog = cfgData.featuresCatalog ?? [];
  const websiteTypes = cfgData.websiteTypes ?? [];
  const hostingTriggerFeatures = cfgData.hostingTriggerFeatures ?? [];
  const initialType = cfgData.initialType ?? 'company';
  const initialPages = cfgData.initialPages ?? [];
  const initialFeatures = cfgData.initialFeatures ?? [];
  const initialPreset = cfgData.initialPreset ?? presets.company;

  const pageLabels = Object.fromEntries(pagesCatalog.map((item) => [item.id, item.label]));
  const featureLabels = Object.fromEntries(featuresCatalog.map((item) => [item.id, item.title]));
  const websiteTypeLabels = Object.fromEntries(websiteTypes.map((item) => [item.id, item.label]));

  const backendFeatureKeys = new Set(['auth', 'admin-panel', 'payments', 'order-system', 'dynamic-cms-db']);
  const advancedFeatureKeys = new Set(['seo', 'analytics']);
  const backendPageKeys = new Set(['dashboard', 'shop', 'checkout']);
  const advancedPageKeys = new Set(['blog']);
  const nonPreselectedRecommendedFeatureKeys = new Set(['analytics']);
  const baselineTierByWebsiteType = {
    landing: 1,
    company: 2,
    portfolio: 2,
    blog: 2,
    ecommerce: 3,
    webapp: 3
  };

  const backendFeatureReasonMap = {
    auth: 'User accounts',
    'admin-panel': 'Admin panel',
    payments: 'Payments',
    'order-system': 'Order system',
    'dynamic-cms-db': 'Dynamic CMS + database'
  };

  const advancedFeatureReasonMap = {
    seo: 'Advanced SEO',
    analytics: 'Analytika (mƒõ≈ôen√≠ + nastaven√≠)'
  };

  const backendPageReasonMap = {
    dashboard: 'User dashboard',
    shop: 'Shop section',
    checkout: 'Checkout flow'
  };

  const advancedPageReasonMap = {
    blog: 'Blog page'
  };

  const computeTier = (config) => {
    const selectedFeatures = [...(config.features ?? [])];
    const selectedPages = [...(config.pages ?? [])];
    const baselineTier = baselineTierByWebsiteType[config.websiteType] ?? 2;

    const backendReasons = [];
    const advancedReasons = [];

    selectedFeatures.forEach((featureId) => {
      if (backendFeatureKeys.has(featureId) && backendFeatureReasonMap[featureId]) {
        backendReasons.push(backendFeatureReasonMap[featureId]);
      }
      if (advancedFeatureKeys.has(featureId) && advancedFeatureReasonMap[featureId]) {
        advancedReasons.push(advancedFeatureReasonMap[featureId]);
      }
    });

    selectedPages.forEach((pageId) => {
      if (backendPageKeys.has(pageId) && backendPageReasonMap[pageId]) {
        backendReasons.push(backendPageReasonMap[pageId]);
      }
      if (advancedPageKeys.has(pageId) && advancedPageReasonMap[pageId]) {
        advancedReasons.push(advancedPageReasonMap[pageId]);
      }
    });

    const uniqueBackendReasons = Array.from(new Set(backendReasons));
    const uniqueAdvancedReasons = Array.from(new Set(advancedReasons));

    let computedTier = 1;
    let triggerReasons = [];

    if (uniqueBackendReasons.length > 0) {
      computedTier = 3;
      triggerReasons = uniqueBackendReasons;
    } else if (uniqueAdvancedReasons.length > 0) {
      computedTier = 2;
      triggerReasons = uniqueAdvancedReasons;
    }

    const finalTier = Math.max(baselineTier, computedTier);

    return {
      tier: finalTier,
      timelineText: finalTier === 3 ? '~30 working days' : finalTier === 2 ? '15 working days' : '5 working days',
      hostingType: finalTier === 3 ? 'fullstack' : 'static',
      upgradeReasons: finalTier > baselineTier ? triggerReasons : []
    };
  };

  const state = {
    step: 1,
    websiteType: initialType,
    pages: new Set(initialPages),
    features: new Set(initialFeatures),
    pagesRequired: new Set(initialPreset.pages.required),
    pagesRecommended: new Set(initialPreset.pages.recommended),
    featuresRequired: new Set(initialPreset.features.required),
    featuresRecommended: new Set(initialPreset.features.recommended),
    hosting: initialPreset.hosting,
    design: {
      template: 'modern',
      fontPair: 'inter-space',
      mode: 'light',
      colors: {
        primary: '#135bec',
        secondary: '#0f172a',
        accent: '#22c55e',
        background: '#ffffff',
        text: '#0f172a'
      },
      fontHeading: "'Space Grotesk', Inter, sans-serif",
      fontBody: 'Inter, sans-serif'
    },
    details: {
      budget: '5k-10k',
      timeline: '4‚Äì8 t√Ωdn≈Ø',
      contentReady: 'Ano',
      referenceWebsite: '',
      targetMarket: '',
      additionalNotes: ''
    }
  };

  const stepPanels = Array.from(document.querySelectorAll('[data-step-panel]'));
  const stepCounter = document.getElementById('stepCounter');
  const stepTitle = document.getElementById('stepTitle');
  const stepProgress = document.getElementById('stepProgress');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  const form = document.getElementById('configuratorForm');
  const hostingIndicator = document.getElementById('hostingIndicator');
  const hostingExplanation = document.getElementById('hostingExplanation');

  const summaryStructured = document.getElementById('summaryStructured');
  const summaryPrice = document.getElementById('summaryPrice');
  const summaryTimeline = document.getElementById('summaryTimeline');
  const priceHintWrap = document.getElementById('priceHintWrap');
  const timelineHintWrap = document.getElementById('timelineHintWrap');
  const priceHintTooltip = document.getElementById('priceHintTooltip');
  const timelineHintTooltip = document.getElementById('timelineHintTooltip');

  const configJsonInput = document.getElementById('configJson');
  const hostingTypeInput = document.getElementById('hostingType');
  const estimatedPriceRangeInput = document.getElementById('estimatedPriceRange');
  const estimatedTimelineValueInput = document.getElementById('estimatedTimelineValue');

  const previewRoot = document.getElementById('livePreview');

  const typeButtons = Array.from(document.querySelectorAll('[data-website-type]'));
  const pageButtons = Array.from(document.querySelectorAll('[data-toggle-item][data-kind="page"]'));
  const featureButtons = Array.from(document.querySelectorAll('[data-toggle-item][data-kind="feature"]'));

  const templateButtons = Array.from(document.querySelectorAll('[data-template]'));
  const fontPairButtons = Array.from(document.querySelectorAll('[data-font-pair]'));
  const modeButtons = Array.from(document.querySelectorAll('[data-mode]'));
  const colorPickers = Array.from(document.querySelectorAll('[data-color]'));

  const detailButtons = Array.from(document.querySelectorAll('[data-detail]'));
  const referenceWebsiteInput = document.getElementById('referenceWebsite');
  const targetMarketInput = document.getElementById('targetMarket');
  const additionalNotesInput = document.getElementById('additionalNotes');

  const featureTooltips = Array.from(document.querySelectorAll('[data-tooltip-trigger]'));

  const totalSteps = 6;

  const getPreset = (typeId) => presets[typeId] ?? presets.company;

  const applyPreset = (typeId) => {
    state.websiteType = typeId;
    const preset = getPreset(typeId);

    const recommendedFeatures = Array.from(new Set([...(preset.features.recommended ?? []), 'seo']));
    const autoSelectedRecommendedFeatures = recommendedFeatures.filter((featureId) => !nonPreselectedRecommendedFeatureKeys.has(featureId));

    const selectedPages = [...preset.pages.required, ...preset.pages.recommended, ...preset.pages.default];
    const selectedFeatures = [...preset.features.required, ...autoSelectedRecommendedFeatures, ...preset.features.default];

    state.pages = new Set(selectedPages);
    state.features = new Set(selectedFeatures);
    state.pagesRequired = new Set(preset.pages.required);
    state.pagesRecommended = new Set(preset.pages.recommended);
    state.featuresRequired = new Set(preset.features.required);
    state.featuresRecommended = new Set(recommendedFeatures);
    state.hosting = preset.hosting;

    detectHosting();
    renderTypeButtons();
    renderToggleStates();
    renderSummary();
  };

  const detectHosting = () => {
    const tierResult = computeTier({
      websiteType: state.websiteType,
      pages: state.pages,
      features: state.features
    });

    state.hosting = tierResult.hostingType;

    if (hostingIndicator) {
      hostingIndicator.textContent = state.hosting === 'fullstack' ? 'Hosting: Full-stack (nutn√Ω)' : 'Hosting: Statick√Ω';
    }
  };

  const setBadge = (button, status) => {
    const badge = button.querySelector('[data-state-badge]');
    if (!badge) return;

    if (status === 'required') {
      badge.textContent = 'Povinn√© üîí';
      badge.classList.remove('hidden');
    } else if (status === 'recommended') {
      badge.textContent = 'Doporuƒçen√© ‚≠ê';
      badge.classList.remove('hidden');
    } else {
      badge.textContent = '';
      badge.classList.add('hidden');
    }
  };

  const renderTypeButtons = () => {
    typeButtons.forEach((btn) => {
      const active = btn.dataset.id === state.websiteType;
      btn.classList.toggle('is-active', active);
      btn.setAttribute('aria-pressed', active ? 'true' : 'false');
    });
  };

  const renderToggleStates = () => {
    pageButtons.forEach((btn) => {
      const id = btn.dataset.id;
      const selected = state.pages.has(id);
      const required = state.pagesRequired.has(id);
      const recommended = state.pagesRecommended.has(id);

      btn.classList.toggle('is-selected', selected);
      btn.classList.toggle('is-locked', required);
      btn.setAttribute('aria-pressed', selected ? 'true' : 'false');
      setBadge(btn, required ? 'required' : recommended ? 'recommended' : 'default');
    });

    featureButtons.forEach((btn) => {
      const id = btn.dataset.id;
      const selected = state.features.has(id);
      const required = state.featuresRequired.has(id);
      const recommended = state.featuresRecommended.has(id);

      btn.classList.toggle('is-selected', selected);
      btn.classList.toggle('is-locked', required);
      btn.setAttribute('aria-pressed', selected ? 'true' : 'false');
      setBadge(btn, required ? 'required' : recommended ? 'recommended' : 'default');
    });
  };

  const renderPreview = () => {
    if (!(previewRoot instanceof HTMLElement)) return;

    const isDarkMode = state.design.mode === 'dark';
    const effectiveBackground = isDarkMode
      ? `color-mix(in srgb, ${state.design.colors.secondary} 78%, #0b1220 22%)`
      : state.design.colors.background;
    const effectiveText = isDarkMode ? '#e2e8f0' : state.design.colors.text;

    previewRoot.dataset.template = state.design.template;
    previewRoot.dataset.mode = state.design.mode;

    previewRoot.style.setProperty('--primary', state.design.colors.primary);
    previewRoot.style.setProperty('--secondary', state.design.colors.secondary);
    previewRoot.style.setProperty('--accent', state.design.colors.accent);
    previewRoot.style.setProperty('--background', effectiveBackground);
    previewRoot.style.setProperty('--text', effectiveText);
    previewRoot.style.setProperty('--font-heading', state.design.fontHeading);
    previewRoot.style.setProperty('--font-body', state.design.fontBody);
  };

  const estimateProject = () => {
    const tierResult = computeTier({
      websiteType: state.websiteType,
      pages: state.pages,
      features: state.features
    });

    const tierBase = {
      1: [1400, 3200],
      2: [3200, 7600],
      3: [7600, 22000]
    };

    const [baseMin, baseMax] = tierBase[tierResult.tier] ?? tierBase[2];
    const pageCount = state.pages.size;
    const featureCount = state.features.size;

    const designBoost = state.design.template === 'custom' ? [700, 1500] : state.design.template === 'bold' || state.design.template === 'elegant' ? [250, 700] : [0, 0];

    const min = baseMin + pageCount * 120 + featureCount * 180 + designBoost[0];
    const max = baseMax + pageCount * 240 + featureCount * 420 + designBoost[1];

    return {
      price: `‚Ç¨${min.toLocaleString('cs-CZ')} ‚Äì ‚Ç¨${max.toLocaleString('cs-CZ')}`,
      timeline: tierResult.timelineText,
      timelineTier: tierResult.tier,
      upgradeReasons: tierResult.upgradeReasons
    };
  };

  const renderSummary = () => {
    detectHosting();
    const estimate = estimateProject();
    const tierResult = computeTier({
      websiteType: state.websiteType,
      pages: state.pages,
      features: state.features
    });

    const selectedPageLabels = [...state.pages].map((id) => pageLabels[id]).filter(Boolean);
    const selectedFeatureLabels = [...state.features].map((id) => featureLabels[id]).filter(Boolean);

    const templateLabels = {
      modern: 'Modern√≠',
      minimal: 'Minimalistick√Ω',
      bold: 'V√Ωrazn√Ω',
      elegant: 'Elegantn√≠',
      custom: 'Vlastn√≠'
    };

    const escapeHtml = (value) =>
      String(value)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');

    const formatChipList = (items, fallback) => {
      if (!items.length) {
        return `<span class="inline-flex items-center rounded-full border border-slate-200 dark:border-slate-700 px-2.5 py-1 text-xs font-semibold text-slate-500 dark:text-slate-400">${fallback}</span>`;
      }

      return items
        .map(
          (item) =>
            `<span class="inline-flex items-center rounded-full border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-2.5 py-1 text-xs font-semibold text-slate-700 dark:text-slate-300">${escapeHtml(item)}</span>`
        )
        .join('');
    };

    const tierLabel =
      tierResult.tier === 3
        ? 'Tier 3 (Enterprise / Full-stack)'
        : tierResult.tier === 2
          ? 'Tier 2 (Business / Advanced Static)'
          : '';

    const hintReasons = estimate.upgradeReasons.slice(0, 3);
    const showHints = tierResult.tier > 1 && hintReasons.length > 0;
    const hintHtml = showHints
      ? `<p class="font-semibold mb-1">This project includes:</p><ul class="list-disc pl-4 space-y-0.5 mb-2">${hintReasons
          .map((reason) => `<li>${escapeHtml(reason)}</li>`)
          .join('')}</ul><p>These selections increase complexity and delivery scope.</p>`
      : '';

    const detailsRows = [
      `<div class="flex items-start justify-between gap-3"><span class="text-slate-500 dark:text-slate-400">Rozpoƒçet</span><span class="font-semibold text-slate-800 dark:text-slate-100">${escapeHtml(state.details.budget)}</span></div>`,
      `<div class="flex items-start justify-between gap-3"><span class="text-slate-500 dark:text-slate-400">Preferovan√Ω term√≠n</span><span class="font-semibold text-slate-800 dark:text-slate-100">${escapeHtml(state.details.timeline)}</span></div>`
    ];

    if (state.details.referenceWebsite) {
      detailsRows.push(
        `<div class="flex items-start justify-between gap-3"><span class="text-slate-500 dark:text-slate-400">Reference</span><span class="font-semibold text-right text-slate-800 dark:text-slate-100 break-all">${escapeHtml(state.details.referenceWebsite)}</span></div>`
      );
    }

    if (state.details.targetMarket) {
      detailsRows.push(
        `<div class="flex items-start justify-between gap-3"><span class="text-slate-500 dark:text-slate-400">C√≠lov√Ω trh</span><span class="font-semibold text-right text-slate-800 dark:text-slate-100">${escapeHtml(state.details.targetMarket)}</span></div>`
      );
    }

    if (state.details.additionalNotes) {
      detailsRows.push(
        `<div class="pt-2 border-t border-slate-200 dark:border-slate-700"><p class="text-slate-500 dark:text-slate-400 mb-1">Pozn√°mky</p><p class="font-semibold text-slate-800 dark:text-slate-100 whitespace-pre-wrap break-words">${escapeHtml(state.details.additionalNotes)}</p></div>`
      );
    }

    if (summaryStructured) {
      summaryStructured.innerHTML = `
        <section class="space-y-2">
          <h4 class="text-xs font-black uppercase tracking-[0.1em] text-slate-500 dark:text-slate-400">A) P≈ôehled</h4>
          <div class="space-y-1.5">
            <div class="flex items-start justify-between gap-3"><span class="text-slate-500 dark:text-slate-400">Typ webu</span><span class="font-semibold text-slate-800 dark:text-slate-100">${escapeHtml(websiteTypeLabels[state.websiteType])}</span></div>
            <div class="flex items-start justify-between gap-3"><span class="text-slate-500 dark:text-slate-400">Hosting</span><span class="font-semibold text-slate-800 dark:text-slate-100">${state.hosting === 'fullstack' ? 'Full-stack' : 'Statick√Ω'}</span></div>
            <div class="flex items-start justify-between gap-3"><span class="text-slate-500 dark:text-slate-400">Term√≠n</span><span class="font-semibold text-slate-800 dark:text-slate-100">${escapeHtml(estimate.timeline)}</span></div>
            <div class="flex items-start justify-between gap-3"><span class="text-slate-500 dark:text-slate-400">Cena</span><span class="font-semibold text-slate-800 dark:text-slate-100">${escapeHtml(estimate.price)}</span></div>
            ${tierLabel ? `<div class="text-xs font-semibold text-primary inline-flex items-center gap-2">Upgradovan√Ω tier: ${tierLabel}${showHints ? `<span data-summary-hint-wrap class="cfg-summary-hint-wrap"><button type="button" data-summary-hint-trigger class="cfg-summary-hint-trigger" aria-label="N√°povƒõda k upgradovan√©mu tieru">‚ìò</button><span class="cfg-summary-hint-tooltip">${hintHtml}</span></span>` : ''}</div>` : ''}
          </div>
        </section>

        <section class="space-y-2 pt-3 border-t border-slate-200 dark:border-slate-700">
          <h4 class="text-xs font-black uppercase tracking-[0.1em] text-slate-500 dark:text-slate-400">B) Obsah webu</h4>
          <div class="flex flex-wrap gap-2">${formatChipList(selectedPageLabels, 'Bez v√Ωbƒõru')}</div>
        </section>

        <section class="space-y-2 pt-3 border-t border-slate-200 dark:border-slate-700">
          <h4 class="text-xs font-black uppercase tracking-[0.1em] text-slate-500 dark:text-slate-400">C) Funkce</h4>
          <div class="flex flex-wrap gap-2">${formatChipList(selectedFeatureLabels, 'Bez v√Ωbƒõru')}</div>
        </section>

        <section class="space-y-2 pt-3 border-t border-slate-200 dark:border-slate-700">
          <h4 class="text-xs font-black uppercase tracking-[0.1em] text-slate-500 dark:text-slate-400">D) Design</h4>
          <div class="space-y-1.5">
            <div class="flex items-start justify-between gap-3"><span class="text-slate-500 dark:text-slate-400">≈†ablona</span><span class="font-semibold text-slate-800 dark:text-slate-100">${escapeHtml(templateLabels[state.design.template] ?? state.design.template)}</span></div>
            <div class="flex items-start justify-between gap-3"><span class="text-slate-500 dark:text-slate-400">P√≠smo</span><span class="font-semibold text-right text-slate-800 dark:text-slate-100">${escapeHtml(state.design.fontPair)}</span></div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 pt-1">
              <div class="inline-flex items-center gap-2"><span class="inline-block size-5 rounded-lg border border-slate-200 dark:border-slate-700" style="background:${escapeHtml(state.design.colors.primary)}"></span><span class="text-xs font-semibold text-slate-700 dark:text-slate-300">Prim√°rn√≠</span></div>
              <div class="inline-flex items-center gap-2"><span class="inline-block size-5 rounded-lg border border-slate-200 dark:border-slate-700" style="background:${escapeHtml(state.design.colors.secondary)}"></span><span class="text-xs font-semibold text-slate-700 dark:text-slate-300">Sekund√°rn√≠</span></div>
              <div class="inline-flex items-center gap-2"><span class="inline-block size-5 rounded-lg border border-slate-200 dark:border-slate-700" style="background:${escapeHtml(state.design.colors.accent)}"></span><span class="text-xs font-semibold text-slate-700 dark:text-slate-300">Akcent</span></div>
              <div class="inline-flex items-center gap-2"><span class="inline-block size-5 rounded-lg border border-slate-200 dark:border-slate-700" style="background:${escapeHtml(state.design.colors.background)}"></span><span class="text-xs font-semibold text-slate-700 dark:text-slate-300">Pozad√≠</span></div>
            </div>
          </div>
        </section>

        <section class="space-y-2 pt-3 border-t border-slate-200 dark:border-slate-700">
          <h4 class="text-xs font-black uppercase tracking-[0.1em] text-slate-500 dark:text-slate-400">E) Detaily projektu</h4>
          <div class="space-y-1.5">${detailsRows.join('')}</div>
        </section>
      `;
    }
    if (summaryPrice) {
      summaryPrice.textContent = estimate.price;
    }
    if (summaryTimeline) {
      summaryTimeline.textContent = estimate.timeline;
    }

    if (hostingExplanation) {
      hostingExplanation.textContent =
        state.hosting === 'fullstack'
          ? 'Full-stack: Cena hostingu z√°vis√≠ na backend funkc√≠ch a oƒçek√°van√© n√°v≈°tƒõvnosti.'
          : 'Statick√Ω web: Hosting zdarma na 1 rok je v cenƒõ.';
    }

    if (priceHintWrap) {
      priceHintWrap.classList.toggle('hidden', !showHints);
      priceHintWrap.classList.remove('is-open');
    }
    if (timelineHintWrap) {
      timelineHintWrap.classList.toggle('hidden', !showHints);
      timelineHintWrap.classList.remove('is-open');
    }
    if (priceHintTooltip) {
      priceHintTooltip.innerHTML = hintHtml;
    }
    if (timelineHintTooltip) {
      timelineHintTooltip.innerHTML = hintHtml;
    }

    const payload = {
      websiteType: state.websiteType,
      pages: [...state.pages],
      features: [...state.features],
      hosting: state.hosting,
      design: state.design,
      details: state.details,
      estimate
    };

    if (configJsonInput instanceof HTMLInputElement) {
      configJsonInput.value = JSON.stringify(payload);
    }
    if (hostingTypeInput instanceof HTMLInputElement) {
      hostingTypeInput.value = state.hosting;
    }
    if (estimatedPriceRangeInput instanceof HTMLInputElement) {
      estimatedPriceRangeInput.value = estimate.price;
    }
    if (estimatedTimelineValueInput instanceof HTMLInputElement) {
      estimatedTimelineValueInput.value = estimate.timeline;
    }
  };

  const renderStep = () => {
    stepPanels.forEach((panel, index) => {
      panel.classList.toggle('hidden', index + 1 !== state.step);
    });

    if (stepCounter) {
      stepCounter.textContent = `Krok ${state.step} / ${totalSteps}`;
    }

    const activePanel = stepPanels[state.step - 1];
    if (stepTitle && activePanel) {
      stepTitle.textContent = activePanel.dataset.title ?? '';
    }

    if (stepProgress) {
      stepProgress.style.width = `${(state.step / totalSteps) * 100}%`;
    }

    if (prevBtn instanceof HTMLButtonElement) {
      prevBtn.disabled = state.step === 1;
    }

    if (nextBtn instanceof HTMLButtonElement && submitBtn instanceof HTMLButtonElement) {
      const finalStep = state.step === totalSteps;
      nextBtn.classList.toggle('hidden', finalStep);
      submitBtn.classList.toggle('hidden', !finalStep);
    }

    if (state.step === totalSteps) {
      renderSummary();
    }
  };

  typeButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const typeId = button.dataset.id;
      if (!typeId || typeId === state.websiteType) return;
      applyPreset(typeId);
    });
  });

  pageButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const id = button.dataset.id;
      if (!id) return;
      if (state.pagesRequired.has(id)) return;

      if (state.pages.has(id)) {
        state.pages.delete(id);
      } else {
        state.pages.add(id);
      }

      detectHosting();
      renderToggleStates();
      renderSummary();
    });
  });

  featureButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const id = button.dataset.id;
      if (!id) return;
      if (state.featuresRequired.has(id)) return;

      if (state.features.has(id)) {
        state.features.delete(id);
      } else {
        state.features.add(id);
      }

      detectHosting();
      renderToggleStates();
      renderSummary();
    });
  });

  templateButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const template = button.dataset.template;
      if (!template) return;
      state.design.template = template;

      templateButtons.forEach((item) => item.classList.toggle('is-selected', item === button));
      renderPreview();
      renderSummary();
    });
  });

  fontPairButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const pair = button.dataset.fontPair;
      if (!pair) return;

      state.design.fontPair = pair;
      state.design.fontHeading = button.dataset.headingFont ?? "'Space Grotesk', Inter, sans-serif";
      state.design.fontBody = button.dataset.bodyFont ?? 'Inter, sans-serif';

      fontPairButtons.forEach((item) => item.classList.toggle('is-selected', item === button));
      renderPreview();
      renderSummary();
    });
  });

  modeButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const mode = button.dataset.mode;
      if (!mode) return;
      state.design.mode = mode;
      modeButtons.forEach((item) => item.classList.toggle('is-selected', item === button));
      renderPreview();
      renderSummary();
    });
  });

  colorPickers.forEach((picker) => {
    picker.addEventListener('input', () => {
      const key = picker.dataset.color;
      if (!key) return;
      state.design.colors[key] = picker.value;
      renderPreview();
      renderSummary();
    });
  });

  detailButtons.forEach((button) => {
    button.addEventListener('click', () => {
      const key = button.dataset.detail;
      const value = button.dataset.value;
      if (!key || !value) return;

      state.details[key] = value;

      detailButtons
        .filter((item) => item.dataset.detail === key)
        .forEach((item) => item.classList.toggle('is-selected', item === button));

      renderSummary();
    });
  });

  referenceWebsiteInput?.addEventListener('input', () => {
    state.details.referenceWebsite = referenceWebsiteInput.value;
  });

  targetMarketInput?.addEventListener('input', () => {
    state.details.targetMarket = targetMarketInput.value;
  });

  additionalNotesInput?.addEventListener('input', () => {
    state.details.additionalNotes = additionalNotesInput.value;
  });

  featureTooltips.forEach((trigger) => {
    trigger.addEventListener('click', (event) => {
      event.preventDefault();
      event.stopPropagation();
      const card = trigger.closest('.cfg-feature-card');
      if (!card) return;
      card.classList.toggle('tooltip-open');
    });
  });

  document.addEventListener('click', (event) => {
    const target = event.target instanceof Element ? event.target : null;
    const hintTrigger = target?.closest('[data-summary-hint-trigger]');

    if (hintTrigger) {
      event.preventDefault();
      event.stopPropagation();
      const wrap = hintTrigger.closest('[data-summary-hint-wrap]');
      if (!wrap) return;

      const wasOpen = wrap.classList.contains('is-open');
      document.querySelectorAll('[data-summary-hint-wrap].is-open').forEach((item) => item.classList.remove('is-open'));
      if (!wasOpen) {
        wrap.classList.add('is-open');
      }
      return;
    }

    document.querySelectorAll('.cfg-feature-card.tooltip-open').forEach((card) => card.classList.remove('tooltip-open'));
    document.querySelectorAll('[data-summary-hint-wrap].is-open').forEach((item) => item.classList.remove('is-open'));
  });

  if (nextBtn instanceof HTMLButtonElement) {
    nextBtn.addEventListener('click', () => {
      if (state.step < totalSteps) {
        state.step += 1;
        renderStep();
      }
    });
  }

  if (prevBtn instanceof HTMLButtonElement) {
    prevBtn.addEventListener('click', () => {
      if (state.step > 1) {
        state.step -= 1;
        renderStep();
      }
    });
  }

  form?.addEventListener('submit', () => {
    renderSummary();
  });

  const searchParams = new URLSearchParams(window.location.search);
  const presetParam = searchParams.get('preset');
  const websiteTypeParam = searchParams.get('websiteType');

  const normalizeKey = (value) =>
    (value ?? '')
      .toLowerCase()
      .trim()
      .replace(/\s+/g, '-')
      .replace(/_/g, '-');

  const presetToWebsiteTypeMap = {
    landing: 'landing',
    design: 'company',
    'custom-web': 'webapp',
    seo: 'blog',
    analytics: 'company',
    support: 'company',
    'similar-case': 'portfolio',
    company: 'company',
    'company-website': 'company',
    portfolio: 'portfolio',
    blog: 'blog',
    ecommerce: 'ecommerce',
    'e-commerce': 'ecommerce',
    webapp: 'webapp'
  };

  const mappedFromPreset = presetParam ? presetToWebsiteTypeMap[normalizeKey(presetParam)] : undefined;
  const directType = websiteTypeParam ? presetToWebsiteTypeMap[normalizeKey(websiteTypeParam)] : undefined;
  const initialWebsiteType = directType || mappedFromPreset || state.websiteType;

  if (initialWebsiteType && presets[initialWebsiteType]) {
    state.websiteType = initialWebsiteType;
  }

  applyPreset(state.websiteType);
  renderPreview();
  renderStep();
</script>
